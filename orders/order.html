<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order Details</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nunito Sans', sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f7f7f7;
    }
    .order-container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    h1 {
      margin-bottom: 0.5rem;
    }
    .order-status {
      margin-bottom: 2rem;
      color: #555;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .card {
      background: #f1f1f1;
      padding: 1rem;
      border-radius: 8px;
    }
    .card h3 {
      margin-top: 0;
    }
    .item {
      display: flex;
      margin-bottom: 1rem;
    }
    .item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      margin-right: 1rem;
    }
    .item-details {
      flex: 1;
    }
    .totals {
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="order-container">
    <h1 id="order-id">Order #...</h1>
    <div class="order-status" id="order-status">Status: ...</div>

    <div class="grid">
      <div class="card">
        <h3>Shipping Info</h3>
        <div id="shipping-info"></div>
      </div>
      <div class="card">
        <h3>Billing Info</h3>
        <div id="billing-info"></div>
      </div>
    </div>

    <div class="card">
      <h3>Items</h3>
      <div id="items"></div>
    </div>

    <div class="totals">
      <div>Subtotal: <span id="subtotal">...</span></div>
      <div>Shipping: <span id="shipping">...</span></div>
      <div><strong>Total: <span id="total">...</span></strong></div>
    </div>
  </div>

  <script type="module">
    import { db } from '../firebase.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js';

    const params = new URLSearchParams(window.location.search);
    const orderId = params.get('order');

    if (!orderId) {
      alert('Order not found.');
      throw new Error('No order ID in URL.');
    }

    document.getElementById('order-id').textContent = `Order #${orderId}`;

    const snap = await getDoc(doc(db, 'Orders', orderId));
    if (!snap.exists()) {
      alert('Order not found.');
      throw new Error('Order does not exist');
    }

    const order = snap.data();
    document.getElementById('order-status').textContent = `Status: ${order.status || 'Confirmed'}`;

    document.getElementById('shipping-info').innerHTML = `
      ${order.name}<br>
      ${order.address?.line1}<br>
      ${order.address?.town}<br>
      ${order.address?.postcode}<br>
      ${order.address?.country}<br>
      ${order.phone || ''}
    `;

    document.getElementById('billing-info').innerHTML = document.getElementById('shipping-info').innerHTML;

    let subtotal = 0;
    const items = order.items || [];
    const itemsContainer = document.getElementById('items');
    items.forEach(item => {
      subtotal += item.price * item.qty;
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}" />
        <div class="item-details">
          <strong>${item.name}</strong><br>
          Size: ${item.size}<br>
          £${item.price.toFixed(2)} x ${item.qty}
        </div>
      `;
      itemsContainer.appendChild(div);
    });

    document.getElementById('subtotal').textContent = `£${subtotal.toFixed(2)}`;
    document.getElementById('shipping').textContent = `£${(order.shipping || 0).toFixed(2)}`;
    document.getElementById('total').textContent = `£${(subtotal + (order.shipping || 0)).toFixed(2)}`;
  </script>
</body>
</html>
